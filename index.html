<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="css/reset.css"> <!-- CSS reset -->
	<link rel="stylesheet" href="css/style.css"> <!-- Resource style -->
	<script src="js/modernizr.js"></script> <!-- Modernizr -->
	<title>Kitsunebi 使用常见问题</title>
</head>
<body>
<header>
	<h1>Kitsunebi 使用常见问题</h1>
</header>
<section class="cd-faq">
  <ul class="cd-faq-categories">
    <li><a class="selected" href="#basics">常见问题</a></li>
  </ul> <!-- cd-faq-categories -->

	<div class="cd-faq-items">
		<ul id="basics" class="cd-faq-group">
			<li>
				<a class="cd-faq-trigger" href="#0">域名策略 DNS 和 Tunnel DNS 分别被用在哪里？</a>
				<div class="cd-faq-content">
        <p>tl;dr</p>
        <p>Tunnel DNS 不太重要，建议设置为国外的 DNS。</p>
        <p>域名策略 DNS 可以用来覆盖系统 DNS，启用 “覆盖系统 DNS” 即可，如果选择覆盖系统 DNS，建议以国内 DNS 为主，例如：223.5.5.5,8.8.8.8，否则可以国外 DNS 为主，例如：8.8.8.8,223.5.5.5。</p>
        <br/>
        <p>首先需要分清楚解析域名的请求由什么进程发起的，大体上分两类，一是 VPN 进程（即运行 Core 的进程），二是非 VPN 进程。</p>
        <br/>
        <p>域名策略 DNS：这个 DNS 会被用到路由决策（规则匹配）以及 Freedom Outbound 中。当路由策略为 IPIfNonMatch/IPOnDemand 时，这个 DNS 就会有机会被用在请求域名的解析；当 Freedom Outbound 的 域名策略为 UseIP 时（通过启用 “覆盖系统 DNS” 来设置，默认值为 AsIs，即使用系统 DNS），所有走 Freedom Outbound (direct) 的请求的域名都会用这个 DNS 来解析。</p>
        <br/>
        <p>Tunnel DNS：当其它 App、其它进程（即 VPN 进程以外的其它程序）需要做域名解析时，这个 DNS 就会被用到。</p>
        <br/>
        <p>举例说，Kitsunebi（Kitsunebi 的 UI App 本身不是 VPN 进程）有对服务器做 ping 测速的功能，当服务器地址为域名时，Kitsunebi 做测速前就要先解析域名，这时就会用 Tunnel DNS 来做这个解析。有个要注意的地方是，比如说，在开着 Kitsunebi（默认配置）的情况下，当你用浏览器打开百度网页（或其它网页）时，做的是 HTTP(S) 请求，那浏览器是没做 DNS 解析的。</p>
        <br/>
        <p>再举另一个例子，比如 iOS 推送通知服务，貌似是用 TCP 连接方式来实现，并且地址是通过解析域名来获取，并且用 TLS 来传输数据（我真没了解过，不过作为举例就当它是这么回事吧），那这时就会用 Tunnel DNS 来解析地址，取得地址后发起连接，流量经由 tun2socks，给到 Core 的 Socks Inbound，这时因为开了 domainOverride，相应的域名会被取出来，这个域名后面会经过 Core 路由、代理；如果走 Freedom Outbound，那过程看上面；如果走代理，那这个域名会被代理服务器再次解析；所以这个域名最多可能在 3 个地方（发起请求的进程 / Core 路由 / 代理服务器）分别被解析，这 3 个地方各用的 DNS 分别是（Tunnel DNS / 域名策略 DNS / 服务器的 DNS）。</p>
        <br/>
        <p>关于系统 DNS：</p>
        <p>默认情况下，在 VPN 进程里面，Freedom Outbound 做请求时是用系统 DNS 来解析域名的，这个行为是可以改变的，具体方法看上面域名策略 DNS 的解析；当 Core 要向代理服务器发起代理连接（比如 VMess 连接）需要解析域名时，用的也是系统 DNS，这个行为目前不支持更改。</p>
        <br/>
        <p>关于 DNS 请求流量的流向：</p>
        <p>上面主要提到哪些请求使用哪个 DNS，确定了 DNS 服务器后，发起的 DNS 请求的流向也在此作简要的说明。</p>
        <p>非 VPN 进程所发起的 DNS 请求由系统生成，使用的是 Tunnel DNS，作为 UDP 流量经 tun2socks，给到 Core 的 Socks Inbound，之后的路由过程之类的该怎么走怎么走，这种 DNS 请求的日志的状态码是 0。</p>
        <p>Core 发起的 DNS 请求一般由 Core 内置的 DNS 服务器生成，使用域名策略 DNS，作为 UDP 流量，一步到路由过程，之后该怎么走就怎么走，这种 DNS 请求的日志的状态码是 1。（路由请求时做的 DNS 解析和使用 UseIP 作为域名策略的 Freedom Outbound 都属此类）</p>
        <p>Core 发起的使用系统 DNS 的 DNS 请求，由系统生成并处理，不会留下任何日志。（使用 AsIs 作为域名策略的 Freedom Outbound 以及向代理服务器发起代理连接时，都使用这种方式）</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">Full Tunnel? Tunnel HTTP Proxy? 开启哪个？</a>
				<div class="cd-faq-content">
					<p>默认两个都开启。建议必开 Tunnel HTTP Proxy，选择性开 Full Tunnel。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">软件自带的 Test Server 可以无限使用吗？</a>
				<div class="cd-faq-content">
					<p>很明显是不可能的，在 App Store 上的简介中也说了只供参考与测试用，不会有任何稳定性与可用性的保证，这是正式的说法。</p>
          <br/>
					<p>只不过现时测试服务器的维护成本并不高，所以随便你用（小声说</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么耗电百分比显示如此高？</a>
				<div class="cd-faq-content">
					<p>显示耗电如此之多，一方面是因为其它 App 的网络耗电都算到 Kitsunebi 上了；另一方面是因为 v2ray-core 有一个叫 IPIfNonMatch 的功能，在默认配置的情况下，所有国外流量都会经过代理加密（这里的言外之意是，那些本来可以正常访问的国外网络流量也会经过代理加密），所以比起其它同类的主要使用域名规则的软件来说，需要加密更多的流量，就会多耗电了。</p>
          <br/>
					<p>这里需要提点的是，你可以选择不开启 IPIfNonMatch，像其它同类软件一样主要用域名规则，这样应该能得到比较相近的耗电量比；但是，大部分国外的网站就算可以直接访问，速度也并不会很快，所以把所有国外流量代理后很多时候可以起到加速作用；怎么取舍取决于你，默认配置只是作者觉得比较合适大部分人使用的配置。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">Full Tunnel 实际上是个什么样的功能？</a>
				<div class="cd-faq-content">
					<p>简单点说，开启后可以代理 TCP/UDP 流量。不开启的话，就只代理 HTTP/HTTPS 流量。</p>
					<p>有小部分 App 会用到非 HTTP/HTTPS 协议来传数据，这时候就可能需要开 Full Tunnel 来代理这些流量，App 才能正常使用。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">软件功能看起来很丰富，但具体怎么用？</a>
				<div class="cd-faq-content">
					<p>一些基础用法在 App 的脚注中作了简要说明，如果想了解更仔细的用法，可以仔细阅读 <a href="https://www.v2ray.com/" target="_blank">Project V 的文档</a>。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么其它 App 可以正常使用，但 XXX （比如 LINE）却上不了？</a>
				<div class="cd-faq-content">
					<p>因为这些 App 不使用 HTTP/HTTPS。</p>
					<p>解决方法：</p>
          <p>1. 开启 Full Tunnel：高级特性 -&gt; Full Tunnel。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么连接会自动断开？</a>
				<div class="cd-faq-content">
          <p>检查是否开启了“睡眠时断开连接”功能。</p>
					<p>解决方法：</p>
					<p>1. 关闭该功能：通常设置 -&gt; 睡眠时断开连接</p>
          <br/>
					<p>可能是因为使用内存过多， 导致应用进程被 iOS 系统干掉了，因为 iOS 对这类 VPN 进程的内存限制是 15M（官方说明：https://forums.developer.apple.com/thread/73148），这对使用 Golang 的程序来说不太友善。</p>
					<p>解决方法：</p>
					<p>1. 设置一个合理的最大连接数，连接数越大并不代表速度越快，现时推荐设置为 16 或 24。</p>
          <p>2. 规则数量不要太多，过多会影响内存使用量，请保持一个合理的数目，一般不需要超过 3000 条，如果超过这个数目，很明显你的规则需要优化了。</p>
          <p>3. 开启“自动重连”功能：高级特性 -&gt; 自动重连。</p>
          <br/>
					<p>如果遵从上面提到的注意点，但仍然经常会断开，那就可能不是内存的问题，是运行时出错了，就是有 bug 了，如果碰到这种情况，请把你的配置文件以及其它设置信息发给作者反馈问题。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么点击 Widget 的开关时总会跳到 App 里面？</a>
				<div class="cd-faq-content">
					<p>因为你开启“自动重连”了。</p>
					<p>解决方法：</p>
          <p>1. 关闭“自动重连”功能：高级特性 -&gt; 自动重连。</p>
				  <br/>
          <p>注：暂时没有两全其美的方法，这个是 iOS 系统的 bug，已经汇报给苹果就看什么时候会修复了。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">我需要从其它地方导入规则来使用吗？</a>
				<div class="cd-faq-content">
					<p>1. 这点要看个人需求，我觉得安装 App 后默认的规则已经可以满足一般人的需求了，在使用过程中自己根据实际需要往上加就可以。</p>
					<p>2. v2ray-core 一个强大之处是在路由请求时可以把域名解析成 IP，然后用 IP 来来进行 GEOIP 规则匹配，所在如果你选了 IPIfNonMatch（默认) 或 IPOnDemand，你在 Kitsunebi 中使用的 GEOIP 规则跟你在其它软件中使用的 GEOIP 规则是不太一样的，因此可能一条 GEOIP 规则就可以顶上几千条域名规则了，功能上要强大很多。有人或许会担心 DNS 解析的延时，这个其实不必要太在意，有缓存的。当然这种做法也会存在着一些问题，但目前来看影响不大。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">想用 v2ray-core 某项功能，但没找到哪里可以设置，怎么办？</a>
				<div class="cd-faq-content">
					<p>使用自定义配置：高级特性 -&gt; 自定义配置。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么频繁断流？</a>
				<div class="cd-faq-content">
					<p>请详细描述你的问题，“断流”这个词包括的范围太大，任何开发者都不太可能正确理解你所指的是什么，反正你不描述详细，不给任何上下文的话，我是理解不了。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么在同样配置下总是比 XXX 软件慢很多？</a>
				<div class="cd-faq-content">
					<p>首先这个“同样配置”有点暧昧了，App 提供了非常多的配置项，除非你全部熟悉了，不然你不能说是“同样配置”。</p>
          <br/>
					<p>好吧，我其实大概能理解你的意思，下面有几个步骤你可以尝试下（不是按顺序的，每做完一个设置你都可以试试效果）：</p>
					<p>1. 把 App 还原到默认设置：通常设定 -&gt; 重置所有设定。</p>
          <p>2. 开启 Full Tunnel：高级特性 -&gt; Full Tunnel。</p>
          <p>3. 关闭 mux：这个在你的服务器设置里面可以找到。</p>
          <p>4. 删除所有规则：代理规则 -&gt; 删除所有规则。</p>
          <p>5. 更改 DNS。App 里有两个 DNS 设置项，如果你不知道哪个是干什么的，最好就不要改了。</p>
          <p>6. 转换到全局模式：代理模式 -&gt; 全局。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">如何申请 TestFlight 测试？</a>
				<div class="cd-faq-content">
					<p>到这里填表申请：<a href="https://docs.google.com/forms/d/e/1FAIpQLScqdQHq_zjbHOMPKZBzmLnc91HCSROzACd-vO5SqBgmTanuJQ/viewform">点我申请</a></p>
          <br/>
					<p>为什么申请了没通过？一般不会立刻处理，所以需要等几天，处理了的话一般都会通过的，请仔细检查你的邮箱。你不确定的话可以发个简短的邮件询问下，我会简单回复下你是否已处理。</p>
          <br/>
					<p>注：不要发邮件或者在推特上申请，那样不受理。（因为我懒，你到上面填表申请我可以批量处理）</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">为什么上 Telegram 时速度非常慢？</a>
				<div class="cd-faq-content">
					<p>因为 Telegram 使用 TCP 来传输数据，但现时 App 在默认设置下只代理 HTTP 流量，而 Telegram 会优先使用 TCP 来做网络请求，等 TCP 失败后转用 HTTP，你感觉慢就是因为需要等待 TCP 请求失败。</p>
					<p>解决方法：</p>
          <p>1. 开启 Full Tunnel：高级特性 -&gt; Full Tunnel。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">Kitsunebi 生成服务器配置 URI、二维码 URL 的格式是什么？</a>
				<div class="cd-faq-content">
        <p>vmess://base64(security:uuid@host:port)?[urlencode(parameters)]</p>
        <br/>
        <p>其中 base64、urlencode 为函数，security 为加密方式，parameters 是以 &amp; 为分隔符的参数列表，例如：network=kcp&amp;aid=32&amp;remark=服务器1 经过 urlencode 后为 network=kcp&amp;aid=32&amp;remark=%E6%9C%8D%E5%8A%A1%E5%99%A81</p>
        <br/>
        <p>可选参数（参数名称不区分大小写）：</p>
        <p>network  可选的值为 "tcp"、 "kcp" 或 "ws"</p>
        <p>wsPath  WebSocket 的协议路径</p>
        <p>kcpHeader  kcp 的伪装类型</p>
        <p>uplinkCapacity  kcp 的上行容量</p>
        <p>downlinkCapacity  kcp 的下行容量</p>
        <p>h2Path  h2 的路径</p>
        <p>h2Host  h2 的域名</p>
        <p>aid  AlterId</p>
        <p>tls  是否启用 TLS，为 0 或 1</p>
        <p>allowInsecure  TLS 的 AllowInsecure，为 0 或 1</p>
        <p>tlsServer  TLS 的服务器端证书的域名</p>
        <p>mux  是否启用 mux，为 0 或 1</p>
        <p>muxConcurrency  mux 的 最大并发连接数</p>
        <p>remark  备注名称</p>
        <br/>
        <p>导入配置时，不在列表中的参数一般会按照 Core 的默认值处理。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">FAQ 里没有想找的答案怎么办？</a>
				<div class="cd-faq-content">
					<p>可以发个信息给作者反馈下，邮件或者推特都可以。</p>
				</div> <!-- cd-faq-content -->
			</li>

			<li>
				<a class="cd-faq-trigger" href="#0">我可以帮忙完善这个 FAQ 吗？</a>
				<div class="cd-faq-content">
					<p>可以的，FAQ 放在 Github Pages 上，你可以来提 PR：https://github.com/eycorsican/kits-faq</p>
				</div> <!-- cd-faq-content -->
			</li>
		</ul> <!-- cd-faq-group -->

	</div> <!-- cd-faq-items -->
	<a href="#0" class="cd-close-panel">Close</a>
</section> <!-- cd-faq -->
<script src="js/jquery-2.1.1.js"></script>
<script src="js/jquery.mobile.custom.min.js"></script>
<script src="js/main.js"></script> <!-- Resource jQuery -->
</body>
</html>
